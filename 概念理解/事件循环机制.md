![详解JavaScript中的Event Loop（事件循环）机制](https://pic2.zhimg.com/v2-0b35a3df0b2e2712839ce551062e6d7f_1440w.jpg?source=172ae18b)

# 事件循环机制

## 前言

我们都知道，javascript 是一门单线程的、非阻塞的语言。

单线程就说明，js 在执行任何代码的时候都只有一个主线程来执行操作，而非阻塞就意味着当 js 执行异步任务时，主线程需要将异步任务临时挂起，等到异步返回结果时，再根据一定的规则去执行回调事件。

为什么 js 是单线程的语言？因为 js 设计之初的目的就是与浏览器进行交互，当我们对一个 dom 元素进行添加事件的时，再删除 dom 元素，用多线程因该如何处理？所以为了保证程序执行的一致性，采用了单线程。但是，单线程最大的缺点就是执行效率低下，那应该如何是好呢？

为此，人们发明了 web worker 技术。web worker 技术可以理解为运行在后台的 js，它可以进行一些复杂、耗费 cpu 的计算，但是没有 I\O 操作权限，相当于主线程的子线程，所以还是受控于主线程，没有改变单线程的实质。

## 正文

![img](https://pic4.zhimg.com/80/v2-da078fa3eadf3db4bf455904ae06f84b_720w.jpg)

1. 堆和栈：js 代码执行时，会将声明的变量放进内存的的不同位置：堆和栈，堆用来存储对象，栈用来存储基本类型与对象指针。
2. 执行环境/上下文：当 js 的函数被执行时，会产生一个执行上下文，里面存储了该函数的私有作用域、上层作用域指向、方法的参数、这个作用域的 this 对象。

**<u>同步代码</u>**：当 js 代码运行时，由于单线程的原因，只能一个个的执行函数，剩下的函数会被放置在一个地方，这个地方就是执行栈，等到主线程的任务被执行完成返回结果并销毁其执行上下文时，再从任务栈中弹出一个任务给主线程继续执行，知道执行栈中的函数清零。

**<u>异步代码</u>**：当 js 代码执行到异步事件的时候，主线程会将它临时挂起，继续执行执行栈中的其他函数，当异步事件返回结果后，就会进入事件队列，事件队列中的事件不会立即调用，会等到当前的，执行栈中的函数清零之后，主线程处于闲置状态，才会被调用，将异步事件的回调函数放入执行栈，执行其中的同步任务，依次循环往复，就是事件循环
